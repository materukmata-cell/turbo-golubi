"use client";

import { useEffect, useState } from "react";
import { Card, CardContent } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { Input } from "@/components/ui/input";

// ====== –î–ê–ù–ù–´–ï ======
const RECIPES = [
  { id: 1, title: "–û–≤—Å—è–Ω–∫–∞ —Å —è–≥–æ–¥–∞–º–∏", calories: 320, protein: 12, fat: 8, carbs: 50, ingredients: ["–æ–≤—Å—è–Ω—ã–µ —Ö–ª–æ–ø—å—è", "—è–≥–æ–¥—ã"] },
  { id: 2, title: "–°–∞–ª–∞—Ç —Å –∫–∏–Ω–æ–∞", calories: 450, protein: 14, fat: 18, carbs: 55, ingredients: ["–∫–∏–Ω–æ–∞", "–∞–≤–æ–∫–∞–¥–æ"] },
  { id: 3, title: "–õ–æ—Å–æ—Å—å —Å –æ–≤–æ—â–∞–º–∏", calories: 520, protein: 40, fat: 22, carbs: 20, ingredients: ["–ª–æ—Å–æ—Å—å", "–±—Ä–æ–∫–∫–æ–ª–∏"] },
  { id: 4, title: "–û–º–ª–µ—Ç —Å –æ–≤–æ—â–∞–º–∏", calories: 300, protein: 20, fat: 15, carbs: 10, ingredients: ["—è–π—Ü–∞", "–æ–≤–æ—â–∏"] },
  { id: 5, title: "–ì—Ä–µ—á–µ—Å–∫–∏–π –π–æ–≥—É—Ä—Ç —Å –º—ë–¥–æ–º", calories: 280, protein: 18, fat: 6, carbs: 30, ingredients: ["–π–æ–≥—É—Ä—Ç"] },
  { id: 6, title: "–ö—É—Ä–∏–Ω–∞—è –≥—Ä—É–¥–∫–∞ —Å —Ä–∏—Å–æ–º", calories: 480, protein: 42, fat: 8, carbs: 55, ingredients: ["–∫—É—Ä–∏—Ü–∞", "—Ä–∏—Å"] },
  { id: 7, title: "–¢–≤–æ—Ä–æ–≥ —Å —è–≥–æ–¥–∞–º–∏", calories: 250, protein: 28, fat: 5, carbs: 20, ingredients: ["—Ç–≤–æ—Ä–æ–≥"] },
  { id: 8, title: "–°–º—É–∑–∏ –±–∞–Ω–∞–Ω-–∞—Ä–∞—Ö–∏—Å", calories: 400, protein: 16, fat: 14, carbs: 45, ingredients: ["–±–∞–Ω–∞–Ω"] },
  { id: 9, title: "–ß–µ—á–µ–≤–∏—á–Ω—ã–π —Å—É–ø", calories: 350, protein: 22, fat: 6, carbs: 40, ingredients: ["—á–µ—á–µ–≤–∏—Ü–∞"] },
  { id: 10, title: "–ò–Ω–¥–µ–π–∫–∞ —Å –≥—Ä–µ—á–∫–æ–π", calories: 500, protein: 38, fat: 10, carbs: 60, ingredients: ["–∏–Ω–¥–µ–π–∫–∞"] },
  { id: 11, title: "–ü—à—ë–Ω–Ω–∞—è –∫–∞—à–∞", calories: 290, protein: 9, fat: 5, carbs: 55, ingredients: ["–ø—à–µ–Ω–æ"] },
  { id: 12, title: "–†–æ–ª–ª —Å –∫—É—Ä–∏—Ü–µ–π", calories: 440, protein: 30, fat: 14, carbs: 45, ingredients: ["–∫—É—Ä–∏—Ü–∞"] },
  { id: 13, title: "–û–≤–æ—â–Ω–æ–µ —Ä–∞–≥—É", calories: 310, protein: 10, fat: 9, carbs: 40, ingredients: ["–æ–≤–æ—â–∏"] },
  { id: 14, title: "–§–∞–ª–∞—Ñ–µ–ª—å –ü–ü", calories: 380, protein: 16, fat: 12, carbs: 45, ingredients: ["–Ω—É—Ç"] },
  { id: 15, title: "–ö—É—Ä–∏–Ω—ã–µ —Ç–µ—Ñ—Ç–µ–ª–∏", calories: 420, protein: 36, fat: 14, carbs: 20, ingredients: ["–∫—É—Ä–∏—Ü–∞"] },
  { id: 16, title: "–°–∞–ª–∞—Ç —Å —Ñ–∞—Å–æ–ª—å—é", calories: 340, protein: 18, fat: 8, carbs: 45, ingredients: ["—Ñ–∞—Å–æ–ª—å"] },
  { id: 17, title: "–ü—Ä–æ—Ç–µ–∏–Ω–æ–≤—ã–π —Å–º—É–∑–∏", calories: 360, protein: 28, fat: 8, carbs: 30, ingredients: ["–ø—Ä–æ—Ç–µ–∏–Ω"] },
  { id: 18, title: "–°—ã—Ä–Ω–∏–∫–∏ –ü–ü", calories: 390, protein: 30, fat: 12, carbs: 40, ingredients: ["—Ç–≤–æ—Ä–æ–≥"] },
  { id: 19, title: "–ì—Ä–µ—á–∫–∞ —Å –≥—Ä–∏–±–∞–º–∏", calories: 350, protein: 14, fat: 7, carbs: 55, ingredients: ["–≥—Ä–µ—á–∫–∞"] },
  { id: 20, title: "–Ø–∏—á–Ω—ã–π —Å–∞–ª–∞—Ç", calories: 330, protein: 22, fat: 18, carbs: 10, ingredients: ["—è–π—Ü–∞"] }
];

const GOALS = {
  pp: { label: "–ü–ü", protein: 110, fat: 60, carbs: 200 },
  mass: { label: "–ù–∞–±–æ—Ä –º–∞—Å—Å—ã", protein: 150, fat: 80, carbs: 300 },
};

const DAYS = ["–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫", "–í—Ç–æ—Ä–Ω–∏–∫", "–°—Ä–µ–¥–∞", "–ß–µ—Ç–≤–µ—Ä–≥", "–ü—è—Ç–Ω–∏—Ü–∞", "–°—É–±–±–æ—Ç–∞", "–í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ"];

// ====== –ü–†–ò–õ–û–ñ–ï–ù–ò–ï ======
function Clock() {
  const [time, setTime] = useState(new Date());

  useEffect(() => {
    const interval = setInterval(() => setTime(new Date()), 1000);
    return () => clearInterval(interval);
  }, []);

  return (
    <div className="text-sm text-gray-500 mb-2">üïí {time.toLocaleTimeString()}</div>
  );
}

export default function HealthyRecipesApp() {
  // üîê –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è (—É–ø—Ä–æ—â—ë–Ω–Ω–∞—è)
  const [user, setUser] = useState<string | null>(null);
  const [login, setLogin] = useState("");

  // üì¶ –°–æ—Å—Ç–æ—è–Ω–∏—è
  const [goal, setGoal] = useState<keyof typeof GOALS>("pp");
  const [dayMeals, setDayMeals] = useState<any[]>([]);
  const [mealPlan, setMealPlan] = useState<Record<string, any[]>>({});

  // ====== LOCAL STORAGE ======
  useEffect(() => {
    const savedUser = localStorage.getItem("user");
    if (savedUser) setUser(savedUser);

    const savedPlan = localStorage.getItem("mealPlan");
    if (savedPlan) setMealPlan(JSON.parse(savedPlan));

    const savedMeals = localStorage.getItem("dayMeals");
    if (savedMeals) setDayMeals(JSON.parse(savedMeals));
  }, []);

  useEffect(() => {
    if (user) localStorage.setItem("user", user);
  }, [user]);

  useEffect(() => {
    localStorage.setItem("mealPlan", JSON.stringify(mealPlan));
  }, [mealPlan]);

  useEffect(() => {
    localStorage.setItem("dayMeals", JSON.stringify(dayMeals));
  }, [dayMeals]);

  // ====== –ë–ñ–£ ======
  const totals = dayMeals.reduce(
    (acc, r) => {
      acc.protein += r.protein;
      acc.fat += r.fat;
      acc.carbs += r.carbs;
      return acc;
    },
    { protein: 0, fat: 0, carbs: 0 }
  );

  // ====== –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø ======
  if (!user) {
    return (
      <div className="min-h-screen flex items-center justify-center">
        <Card className="w-80">
          <CardContent className="p-6">
            <h2 className="text-xl font-bold mb-4">–í—Ö–æ–¥</h2>
            <Input placeholder="–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è" value={login} onChange={(e) => setLogin(e.target.value)} />
            <Button className="w-full mt-4" onClick={() => setUser(login)}>–í–æ–π—Ç–∏</Button>
          </CardContent>
        </Card>
      </div>
    );
  }

  // ====== –û–°–ù–û–í–ù–û–ô UI ======
  return (
    <div className="min-h-screen p-6 bg-gray-50">
      <Clock />
      <h1 className="text-3xl font-bold mb-2">ü•ó –ü–ª–∞–Ω –ø–∏—Ç–∞–Ω–∏—è</h1>
      <p className="mb-6">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: <b>{user}</b></p>

      {/* –¶–ï–õ–¨ */}
      <div className="flex gap-3 mb-6">
        {Object.entries(GOALS).map(([k, g]) => (
          <Button key={k} variant={goal === k ? "default" : "outline"} onClick={() => setGoal(k as any)}>
            {g.label}
          </Button>
        ))}
      </div>

      {/* –†–ï–¶–ï–ü–¢–´ */}
      <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mb-10">
        {RECIPES.map((r) => (
          <Card key={r.id}>
            <CardContent className="p-4">
              <h3 className="font-semibold">{r.title}</h3>
              <p>{r.calories} –∫–∫–∞–ª</p>
              <Button className="w-full mt-2" onClick={() => setDayMeals([...dayMeals, r])}>–î–æ–±–∞–≤–∏—Ç—å —Å–µ–≥–æ–¥–Ω—è</Button>
            </CardContent>
          </Card>
        ))}
      </div>

      {/* –î–ù–ï–í–ù–ê–Ø –°–¢–ê–¢–ò–°–¢–ò–ö–ê */}
      <Card className="max-w-md mb-10">
        <CardContent className="p-4">
          <h2 className="font-bold mb-2">–°–µ–≥–æ–¥–Ω—è</h2>
          <p>–ë–µ–ª–∫–∏: {totals.protein} / {GOALS[goal].protein}</p>
          <p>–ñ–∏—Ä—ã: {totals.fat} / {GOALS[goal].fat}</p>
          <p>–£–≥–ª–µ–≤–æ–¥—ã: {totals.carbs} / {GOALS[goal].carbs}</p>
        </CardContent>
      </Card>

      {/* –ü–õ–ê–ù –ü–ò–¢–ê–ù–ò–Ø */}
      <h2 className="text-2xl font-bold mb-4">üìÖ –ü–ª–∞–Ω –Ω–∞ –Ω–µ–¥–µ–ª—é</h2>
      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
        {DAYS.map((day) => (
          <Card key={day}>
            <CardContent className="p-4">
              <h3 className="font-semibold mb-2">{day}</h3>
              {(mealPlan[day] || []).map((m, i) => (
                <p key={i} className="text-sm">‚Ä¢ {m.title}</p>
              ))}
              <Button
                className="w-full mt-2"
                variant="outline"
                onClick={() => setMealPlan({ ...mealPlan, [day]: [...(mealPlan[day] || []), RECIPES[0]] })}
              >
                –î–æ–±–∞–≤–∏—Ç—å –±–ª—é–¥–æ
              </Button>
            </CardContent>
          </Card>
        ))}
      </div>
    </div>
  );
}

